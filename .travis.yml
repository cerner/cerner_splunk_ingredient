branches:
  except:
    - master
language: ruby
cache: bundler
sudo: false
bundler_args: --without local
rvm:
  - 2.1.8
  - 2.3.1
env:
  - TEST_GROUP=6,5 CHEF_VERSION="<= 12.13.37"
  - TEST_GROUP=6,5 CHEF_VERSION="~> 12.14"
  - TEST_GROUP=1,3 CHEF_VERSION="<= 12.13.37"
  - TEST_GROUP=1,3 CHEF_VERSION="~> 12.14"
  - TEST_GROUP=2,4 CHEF_VERSION="<= 12.13.37"
  - TEST_GROUP=2,4 CHEF_VERSION="~> 12.14"
matrix:
  exclude:
    - rvm: 2.1.8
      env: TEST_GROUP=6,5 CHEF_VERSION="~> 12.14" # Chef 12.14+ requires Ruby 2.2
    - rvm: 2.1.8
      env: TEST_GROUP=1,3 CHEF_VERSION="~> 12.14" # Chef 12.14+ requires Ruby 2.2
    - rvm: 2.1.8
      env: TEST_GROUP=2,4 CHEF_VERSION="~> 12.14" # Chef 12.14+ requires Ruby 2.2
script:
  - bundle exec rubocop
  - bundle exec foodcritic -f any .
  - bundle exec parallel_test spec/unit/ -n 6 --only-group $TEST_GROUP --group-by filesize --type rspec
